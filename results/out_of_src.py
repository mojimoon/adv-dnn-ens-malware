'''
The accuracy on the test dataset is 69.90000%
The balanced accuracy on the test dataset is 57.52049%
Other evaluation metrics we may need:
False Negative Rate (FNR) is 58.37104%, False Positive Rate (FPR) is 26.58797%, F1 score is 23.40967%
The accuracy on the test dataset is 72.90000%
The balanced accuracy on the test dataset is 61.94946%
Other evaluation metrics we may need:
False Negative Rate (FNR) is 52.13483%, False Positive Rate (FPR) is 23.96624%, F1 score is 28.21192%
'''

import os
import csv
import re

pwd = os.getcwd()

src = os.path.join(pwd, 'logs', 'out_of_src.txt')
out = os.path.join(pwd, 'results', 'out_of_src.csv')

with open(src, 'r') as f:
    lines = f.readlines()
    with open(out, 'w', newline='') as csvfile:
        fieldnames = ['id_ratio', 'accuracy', 'balanced_acc', 'FNR', 'FPR', 'F1']
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        writer.writeheader()
        
        for i in range(0, len(lines), 4):
            id_ratio = (i // 4) / 10
            
            # Using regular expressions to extract the metrics
            accuracy_match = re.search(r'The accuracy on the test dataset is ([\d.]+)%', lines[i])
            balanced_acc_match = re.search(r'The balanced accuracy on the test dataset is ([\d.]+)%', lines[i + 1])
            fnr_match = re.search(r'False Negative Rate \(FNR\) is ([\d.]+)%', lines[i + 3])
            fpr_match = re.search(r'False Positive Rate \(FPR\) is ([\d.]+)%', lines[i + 3])
            f1_match = re.search(r'F1 score is ([\d.]+)%', lines[i + 3])

            data = {
                'id_ratio': id_ratio,
                'accuracy': float(accuracy_match.group(1)) / 100,
                'balanced_acc': float(balanced_acc_match.group(1)) / 100,
                'FNR': float(fnr_match.group(1)) / 100,
                'FPR': float(fpr_match.group(1)) / 100,
                'F1': float(f1_match.group(1)) / 100
            }
            writer.writerow(data)